language: node_js
services:
  - docker
node_js:
  - lts/*
dist: trusty
cache: yarn
sudo: required
install:
  - curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
  - echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
  - sudo apt-get update -qq && sudo apt-get install -y -qq yarn yarn
  # install devDependencies so we can run tests
  - yarn install --production=false --skip-integrity-check --non-interactive --no-progress
  - docker-compose build
jobs:
  include:
    - stage: testing
      script:
        - docker-compose up -d
        - yarn test
